{% extends "base.html" %}
{% block content %}
    <h2 class="post-heading">{{ post.title}}</h2>
    <p>{{ post.body }}</p>

    {% if post.film_name %}
        <p><strong>Film Name:</strong> {{ post.film_name }}</p>
    {% endif %}
    {% if post.film_num %}
        <p><strong>Film Number:</strong> {{ post.film_num }}</p>
    {% endif %}
    {% if post.year_of_release %}
        <p><strong>Year of Release:</strong> {{ post.year_of_release }}</p>
    {% endif %}
    {% if post.favourite_character %}
        <p><strong>Favourite Character:</strong> {{ post.favourite_character }}</p>
    {% endif %}
    <p>Posted by {{ post.user.username }} on {{ post.timestamp.strftime("%d-%m-%Y %H:%M") }}</p>

    {% if current_user.is_authenticated and current_user.id == post.user.id %}
        <!-- Edit post button -->
        <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btm edit-post-btn">Edit Post</a>
        <!-- Delete post button -->
        <button class="btn red" data-target="deletePostModal{{ post.id }}" onclick="openModal('deletePostModal{{ post.id }}')">Delete Post</button>
    {% endif %}

    <hr>

    <h4 class="comment-heading">Comments</h4>
    {% for comment in comments %}
        <div class="card">
            <div class="card-content">
                <p class="comment-body">{{ comment.body }}</p>
                <p class="comment-details">Commented by {{ comment.user.username }} on {{ comment.timestamp.strftime("%d-%m-%Y %H:%M") }}</p>

                {% if current_user.id == comment.user_id %}
                    <!-- Delete Comment Button -->
                    <button class="btn red" data-target="deleteCommentModal{{ comment.id }}" onclick="openModal('deleteCommentModal{{ comment.id }}')">Delete Comment</button>
                {% endif %}

            </div>
        </div>
    {% endfor %}

    {% if current_user.is_authenticated %}
        <form method="POST" action="{{ url_for('post', post_id=post.id) }}">
            <div class="input-field">
                <textarea class="materialize-textarea" id="body" name="body" required></textarea>
                <label for="body">Comment</label>
            </div>
            <button type="submit" class="btn submit-comment-btn">Submit</button>
        </form>
    {% else %}
        <p><a href="{{ url_for('login') }}">Sign in</A> to comment.</p>
    {% endif %}

    <br>

    <a href="{{ url_for('index') }}" class="btn BTD-btn">Back to Discussion</a>
    
{% endblock %}